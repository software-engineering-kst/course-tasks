# Задания по базам данных

## Список задач

### Создать таблицу для записи задач (ToDo list)

В таблице должны быть 3 колонки:
- id - первичный ключ
- title - заголовок
- description - подробное описание
- created - время когда была создана запись
- done - флаг выполнено/невыполнено
  
  create table todoList(
  id integer primary key generated by default as identity,
  title varchar(255),
  description text,
  created date,
  done boolean
  );

insert into todolist (title,description,created,done) values ('some title 3','doing somthing',to_timestamp(random()*2147483647),true)

### Написать запрос, который выберет только невыполненные задачи
select * from todolist where done = false
### Написать запрос, который пометит задачу как выполненную
update todolist
set done = true
where done = false
## Учет денег на счетах

Мы хотим хранить информацию о пользователях и о количестве денег на счетах у пользователя.

create table users(
id UUID primary key,
name varchar(32),
amount decimal(10,2) not null default 0.0
);

create table accounts(
id UUID primary key,
amount decimal(10,2) not null default 0.0,
user_id UUID not null references users(id)
);

alter table users drop column amount;


У каждого пользователя может быть от 1 до 10 счетов.

### Создать таблицу для пользователей

В таблице должны быть такие колонки:
- id - первичный ключ
- name - имя пользователя

Для хранения информации про счета нужно создать отдельную таблицу:
- id - первичный ключ
- userId - идентификатор пользователя из 1й таблицы
- title - название счета (например Kaspi, Евразийский банк, Наличка)
- amount - количество денег на счету
- 
//добавляю юзера с пустым счетом
insert into accounts (id,amounts,user_id) values (gen_random_uuid(),0,'adf562c3-c5dd-480f-b7a1-d3ea734a6525')

//добавил аккаунты для двух пользователей с разными счетами
insert into accounts (id,amounts,user_id) values (gen_random_uuid(),3,'72003900-9435-4cda-9541-273e74a53ca7')

insert into accounts (id,amounts,user_id) values (gen_random_uuid(),4,'d8378172-013b-41d7-9cb5-d229d0852fe2')
//дублирую второй аккаунт и задаю ему нулевой счет
insert into accounts (id,amounts,user_id) values (gen_random_uuid(),0,'d8378172-013b-41d7-9cb5-d229d0852fe2')


### Написать запрос, который выберет пользователей, у которых есть деньги на счетах

select distinct u.name
from users u
inner join accounts a on (a.user_id = u.id)
where a.amounts > 0 ;
### Написать запрос, который выведет общее количество денег на всех счетах по каждому пользователю

select u.name,sum(a.amounts)
from users u  
left join accounts a on (a.user_id = u.id)
group by u.id
### Написать запрос, который обнулит сумму на всех счетах конкретного пользователя (по его ID)

update accounts a
set amounts = 0
where a.user_id = '72003900-9435-4cda-9541-273e74a53ca7';

//делаю проверку
select distinct u.name
from users u
left join accounts a on (a.user_id = u.id)
where a.amounts = 0